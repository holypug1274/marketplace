<ng-container *ngIf="vm$ | async as vm">
  <h1>Checkout</h1>

  <mat-accordion class="example-headers-align">
    <mat-expansion-panel
      [expanded]="step === 0"
      (opened)="setStep(0)"
      [disabled]="step > 0"
      hideToggle
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>shopping_cart</mat-icon> Order Summary
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="panel-container">
        <marketplace-product-summary-table
          [products]="vm.products"
          [isEdit]="false"
        ></marketplace-product-summary-table>
      </div>
    </mat-expansion-panel>

    <br />

    <mat-expansion-panel
      [expanded]="step === 1"
      (opened)="setStep(1)"
      [disabled]="step > 1"
      hideToggle
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>location_on</mat-icon> Customer Information
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="panel-container">
        <h3>Shipping Address</h3>
        <marketplace-shipping-address-form
          [group]="vm.shippingAddress"
        ></marketplace-shipping-address-form>

        <ng-container
          *ngIf="!vm.shippingAddress.value['isBillingAddressTheSame']"
        >
          <h3>Billing Address</h3>
          <marketplace-billing-address-form
            [group]="vm.billingAddress"
          ></marketplace-billing-address-form>
        </ng-container>
      </div>
    </mat-expansion-panel>

    <br />

    <mat-expansion-panel
      [expanded]="step === 2"
      (opened)="setStep(2)"
      [disabled]="step > 2"
      hideToggle
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>payments</mat-icon> Payment Details
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="panel-container">
        <marketplace-payment-details-form
          [group]="vm.paymentDetails"
        ></marketplace-payment-details-form>
      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <div class="actions-container">
    <button mat-raised-button color="warn" (click)="cancelOrder()">
      Cancel Order
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="proceedToPayment()"
      [disabled]="
        vm.shippingAddress.invalid ||
        (!vm.shippingAddress.value['isBillingAddressTheSame']
          ? vm.billingAddress.invalid
          : false) ||
        vm.paymentDetails.invalid
      "
    >
      Proceed to Payment
    </button>
  </div>
</ng-container>
